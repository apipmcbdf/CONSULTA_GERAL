<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Dados - Firestore</title>
  <script type="module">
    // Importar as funções necessárias do Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";

    // Configuração do Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyDoXdgj_fRuYTluJby6QOIiEYBu268lZmQ",
  authDomain: "documentos-apipmcbdf.firebaseapp.com",
  projectId: "documentos-apipmcbdf",
  storageBucket: "documentos-apipmcbdf.firebasestorage.app",
  messagingSenderId: "422508459389",
  appId: "1:422508459389:web:bebd6b53839f77a3cd4814"
};

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function consultarDados() {
      const cpf = document.getElementById("cpf").value.trim();
      const resultado = document.getElementById("resultado");
      resultado.innerHTML = "Consultando...";

      try {
        let dadosEncontrados = [];
        const colecoes = ["associadosStatus", "protocolosVPE", "documentacaoAuxilioMoradia", "documentacaoVPE", "protocolosAuxilioMoradia"];

        for (const colecao of colecoes) {
          const docRef = doc(db, colecao, cpf);
          const docSnap = await getDoc(docRef);

          if (docSnap.exists()) {
            dadosEncontrados.push({ colecao, dados: docSnap.data() });
          }
        }

        if (dadosEncontrados.length > 0) {
          let resultadoHTML = "<h3>Dados encontrados:</h3><ul>";
          dadosEncontrados.forEach(item => {
            resultadoHTML += `<li><strong>${item.colecao}:</strong> <pre>${JSON.stringify(item.dados, null, 2)}</pre></li>`;
          });
          resultadoHTML += "</ul>";
          resultado.innerHTML = resultadoHTML;
        } else {
          resultado.innerHTML = "<p style='color: red;'>Nenhum dado encontrado para o CPF informado.</p>";
        }
      } catch (error) {
        console.error("Erro ao consultar dados: ", error);
        resultado.innerHTML = "<p style='color: red;'>Erro ao consultar os dados. Tente novamente.</p>";
      }
    }
  </script>
</head>
<body>
  <div style="text-align: center; padding: 20px;">
    <h1>Consulta de Dados - Firestore</h1>
    <p>Digite o CPF (apenas números) para consultar os dados:</p>
    <input type="text" id="cpf" placeholder="Ex: 12345678900" maxlength="11" style="padding: 10px; width: 200px;">
    <button onclick="consultarDados()" style="padding: 10px 20px; margin-left: 10px;">Consultar</button>
    <div id="resultado" style="margin-top: 20px;"></div>
  </div>
</body>
</html>
